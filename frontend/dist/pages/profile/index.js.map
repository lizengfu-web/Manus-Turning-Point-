{"version":3,"file":"pages/profile/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;ACnmBA;AACA;AACA;AACA;AAAA;AAQA;AAIA;AAFA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAGA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AACA;AAIA;AAAA;AAEA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAEA;AAAA;AAEA;AAAA;AAIA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AAGA;AACA;AAAA;AAGA;AAAA;AACA;AACA;AACA;AAGA;;;;;;;;;;;;;;;AC5OA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://zhuanjiao-yizhan-miniprogram/./src/pages/profile/index.tsx?1006","webpack://zhuanjiao-yizhan-miniprogram/._src_components_PrivacyAgreementModal.tsx","webpack://zhuanjiao-yizhan-miniprogram/._src_constants_privacy.ts","webpack://zhuanjiao-yizhan-miniprogram/._src_pages_profile_index.tsx"],"sourcesContent":["import _defineProperty from \"E:/Manus-Turning-Point-/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _objectSpread from \"E:/Manus-Turning-Point-/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _regenerator from \"E:/Manus-Turning-Point-/frontend/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _asyncToGenerator from \"E:/Manus-Turning-Point-/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"E:/Manus-Turning-Point-/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { View, Text, Button, Image, Input } from '@tarojs/components';\nimport Taro from '@tarojs/taro';\nimport { useUserStore } from '@/store/user';\nimport { wxLogin, logout, getUserInfo, updateUserInfo } from '@/api/auth';\nimport { useState, useEffect } from 'react';\nimport PrivacyAgreementModal from '@/components/PrivacyAgreementModal';\nimport { hasAgreedPrivacyPolicy, savePrivacyPolicyAgreement } from '@/constants/privacy';\nimport './index.scss';\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\nexport default function Profile() {\n  var _useUserStore = useUserStore(),\n    user = _useUserStore.user,\n    setUser = _useUserStore.setUser,\n    clearUser = _useUserStore.clearUser;\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    isEditing = _useState2[0],\n    setIsEditing = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loading = _useState4[0],\n    setLoading = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    showPrivacyModal = _useState6[0],\n    setShowPrivacyModal = _useState6[1];\n  var _useState7 = useState(null),\n    _useState8 = _slicedToArray(_useState7, 2),\n    pendingLogin = _useState8[0],\n    setPendingLogin = _useState8[1];\n  var _useState9 = useState({\n      nickName: '',\n      avatarUrl: '',\n      openId: '',\n      userType: '',\n      province: '',\n      city: '',\n      workYears: 0\n    }),\n    _useState0 = _slicedToArray(_useState9, 2),\n    userInfo = _useState0[0],\n    setUserInfo = _useState0[1];\n  var _useState1 = useState({\n      nickName: '',\n      province: '',\n      city: '',\n      workYears: 0\n    }),\n    _useState10 = _slicedToArray(_useState1, 2),\n    editForm = _useState10[0],\n    setEditForm = _useState10[1];\n\n  // 加载用户信息\n  useEffect(function () {\n    if (user) {\n      loadUserInfo();\n    }\n  }, [user]);\n  var loadUserInfo = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n      var info, _t;\n      return _regenerator().w(function (_context) {\n        while (1) switch (_context.p = _context.n) {\n          case 0:\n            _context.p = 0;\n            setLoading(true);\n            _context.n = 1;\n            return getUserInfo();\n          case 1:\n            info = _context.v;\n            setUserInfo(info);\n            setEditForm({\n              nickName: info.nickName || '',\n              province: info.province || '',\n              city: info.city || '',\n              workYears: info.workYears || 0\n            });\n            _context.n = 3;\n            break;\n          case 2:\n            _context.p = 2;\n            _t = _context.v;\n            Taro.showToast({\n              title: _t.message || '加载用户信息失败',\n              icon: 'none'\n            });\n          case 3:\n            _context.p = 3;\n            setLoading(false);\n            return _context.f(3);\n          case 4:\n            return _context.a(2);\n        }\n      }, _callee, null, [[0, 2, 3, 4]]);\n    }));\n    return function loadUserInfo() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var handleLogin = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2() {\n      var loginRes, _loginRes, code, userProfileInfo, _yield$Taro$getUserPr, _userInfo, _t2, _t3, _t4;\n      return _regenerator().w(function (_context2) {\n        while (1) switch (_context2.p = _context2.n) {\n          case 0:\n            _context2.p = 0;\n            console.log('[Profile] Starting login...');\n\n            // 检查是否已同意隐私协议\n            if (hasAgreedPrivacyPolicy()) {\n              _context2.n = 9;\n              break;\n            }\n            console.log('[Profile] User has not agreed to privacy policy, showing modal');\n            _context2.p = 1;\n            _context2.n = 2;\n            return Taro.login();\n          case 2:\n            loginRes = _context2.v;\n            _context2.n = 4;\n            break;\n          case 3:\n            _context2.p = 3;\n            _t2 = _context2.v;\n            console.error('[Profile] Taro.login System Error:', _t2);\n            throw new Error('微信登录服务暂时不可用');\n          case 4:\n            _loginRes = loginRes, code = _loginRes.code;\n            console.log('[Profile] Got code:', (code === null || code === void 0 ? void 0 : code.substring(0, 10)) + '...');\n\n            // 尝试获取用户信息（可能会失败，但不影响登录）\n            userProfileInfo = {\n              nickName: '微信用户',\n              avatarUrl: ''\n            };\n            _context2.p = 5;\n            _context2.n = 6;\n            return Taro.getUserProfile({\n              desc: '用于完善用户资料'\n            });\n          case 6:\n            _yield$Taro$getUserPr = _context2.v;\n            _userInfo = _yield$Taro$getUserPr.userInfo;\n            userProfileInfo = {\n              nickName: _userInfo.nickName,\n              avatarUrl: _userInfo.avatarUrl\n            };\n            console.log('[Profile] Got user profile');\n            _context2.n = 8;\n            break;\n          case 7:\n            _context2.p = 7;\n            _t3 = _context2.v;\n            // 用户拒绝授权，使用默认值\n            console.log('[Profile] User denied profile access or System Error');\n          case 8:\n            // 保存登录信息，等待用户同意隐私协议\n            setPendingLogin({\n              code: code,\n              userInfo: userProfileInfo\n            });\n            setShowPrivacyModal(true);\n            return _context2.a(2);\n          case 9:\n            _context2.n = 10;\n            return performLogin();\n          case 10:\n            _context2.n = 12;\n            break;\n          case 11:\n            _context2.p = 11;\n            _t4 = _context2.v;\n            console.error('[Profile] Login error:', _t4);\n            Taro.showToast({\n              title: _t4.message || '登录失败',\n              icon: 'none',\n              duration: 3000\n            });\n          case 12:\n            return _context2.a(2);\n        }\n      }, _callee2, null, [[5, 7], [1, 3], [0, 11]]);\n    }));\n    return function handleLogin() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var performLogin = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3(code, userProfileInfo) {\n      var loginCode, loginUserInfo, _loginCode, loginRes, _yield$Taro$getUserPr2, _userInfo2, result, _t5, _t6, _t7;\n      return _regenerator().w(function (_context3) {\n        while (1) switch (_context3.p = _context3.n) {\n          case 0:\n            _context3.p = 0;\n            loginCode = code;\n            loginUserInfo = userProfileInfo;\n            if (loginCode) {\n              _context3.n = 8;\n              break;\n            }\n            console.log('[Profile] Getting new code...');\n            _context3.p = 1;\n            _context3.n = 2;\n            return Taro.login();\n          case 2:\n            loginRes = _context3.v;\n            _context3.n = 4;\n            break;\n          case 3:\n            _context3.p = 3;\n            _t5 = _context3.v;\n            console.error('[Profile] Taro.login System Error:', _t5);\n            throw new Error('微信登录服务暂时不可用');\n          case 4:\n            loginCode = loginRes.code;\n            console.log('[Profile] Got code:', ((_loginCode = loginCode) === null || _loginCode === void 0 ? void 0 : _loginCode.substring(0, 10)) + '...');\n\n            // 尝试获取用户信息\n            loginUserInfo = {\n              nickName: '微信用户',\n              avatarUrl: ''\n            };\n            _context3.p = 5;\n            _context3.n = 6;\n            return Taro.getUserProfile({\n              desc: '用于完善用户资料'\n            });\n          case 6:\n            _yield$Taro$getUserPr2 = _context3.v;\n            _userInfo2 = _yield$Taro$getUserPr2.userInfo;\n            loginUserInfo = {\n              nickName: _userInfo2.nickName,\n              avatarUrl: _userInfo2.avatarUrl\n            };\n            console.log('[Profile] Got user profile');\n            _context3.n = 8;\n            break;\n          case 7:\n            _context3.p = 7;\n            _t6 = _context3.v;\n            console.log('[Profile] User denied profile access or System Error');\n          case 8:\n            console.log('[Profile] Calling wxLogin...');\n            _context3.n = 9;\n            return wxLogin({\n              code: loginCode,\n              userInfo: loginUserInfo\n            });\n          case 9:\n            result = _context3.v;\n            console.log('[Profile] Login successful');\n            setUser(result.user);\n            Taro.showToast({\n              title: '登录成功',\n              icon: 'success'\n            });\n            _context3.n = 11;\n            break;\n          case 10:\n            _context3.p = 10;\n            _t7 = _context3.v;\n            console.error('[Profile] Login error:', _t7);\n            Taro.showToast({\n              title: _t7.message || '登录失败',\n              icon: 'none',\n              duration: 3000\n            });\n          case 11:\n            return _context3.a(2);\n        }\n      }, _callee3, null, [[5, 7], [1, 3], [0, 10]]);\n    }));\n    return function performLogin(_x, _x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var handlePrivacyAgree = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4() {\n      var _t8;\n      return _regenerator().w(function (_context4) {\n        while (1) switch (_context4.p = _context4.n) {\n          case 0:\n            _context4.p = 0;\n            console.log('[Profile] User agreed to privacy policy');\n            // 保存同意状态\n            savePrivacyPolicyAgreement();\n            setShowPrivacyModal(false);\n\n            // 继续登录流程\n            if (!pendingLogin) {\n              _context4.n = 2;\n              break;\n            }\n            _context4.n = 1;\n            return performLogin(pendingLogin.code, pendingLogin.userInfo);\n          case 1:\n            setPendingLogin(null);\n          case 2:\n            _context4.n = 4;\n            break;\n          case 3:\n            _context4.p = 3;\n            _t8 = _context4.v;\n            console.error('[Profile] Error handling privacy agreement:', _t8);\n            Taro.showToast({\n              title: '处理协议失败',\n              icon: 'none'\n            });\n          case 4:\n            return _context4.a(2);\n        }\n      }, _callee4, null, [[0, 3]]);\n    }));\n    return function handlePrivacyAgree() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var handlePrivacyDisagree = function handlePrivacyDisagree() {\n    console.log('[Profile] User disagreed to privacy policy');\n    setShowPrivacyModal(false);\n    setPendingLogin(null);\n    Taro.showToast({\n      title: '您已拒绝隐私协议，无法继续登录',\n      icon: 'none'\n    });\n  };\n  var handleLogout = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5() {\n      var _yield$Taro$showModal, confirm, _t9;\n      return _regenerator().w(function (_context5) {\n        while (1) switch (_context5.p = _context5.n) {\n          case 0:\n            _context5.p = 0;\n            _context5.n = 1;\n            return Taro.showModal({\n              title: '提示',\n              content: '确定要退出登录吗？'\n            });\n          case 1:\n            _yield$Taro$showModal = _context5.v;\n            confirm = _yield$Taro$showModal.confirm;\n            if (confirm) {\n              logout();\n              clearUser();\n              Taro.showToast({\n                title: '已退出登录',\n                icon: 'success'\n              });\n            }\n            _context5.n = 3;\n            break;\n          case 2:\n            _context5.p = 2;\n            _t9 = _context5.v;\n          case 3:\n            return _context5.a(2);\n        }\n      }, _callee5, null, [[0, 2]]);\n    }));\n    return function handleLogout() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  var handleEditChange = function handleEditChange(field, value) {\n    setEditForm(_objectSpread(_objectSpread({}, editForm), {}, _defineProperty({}, field, value)));\n  };\n  var handleSaveEdit = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6() {\n      var updated, _t0;\n      return _regenerator().w(function (_context6) {\n        while (1) switch (_context6.p = _context6.n) {\n          case 0:\n            _context6.p = 0;\n            setLoading(true);\n            _context6.n = 1;\n            return updateUserInfo({\n              nickName: editForm.nickName,\n              province: editForm.province,\n              city: editForm.city,\n              workYears: editForm.workYears\n            });\n          case 1:\n            updated = _context6.v;\n            setUserInfo(updated);\n            setIsEditing(false);\n            Taro.showToast({\n              title: '信息更新成功',\n              icon: 'success'\n            });\n            _context6.n = 3;\n            break;\n          case 2:\n            _context6.p = 2;\n            _t0 = _context6.v;\n            Taro.showToast({\n              title: _t0.message || '更新失败',\n              icon: 'none'\n            });\n          case 3:\n            _context6.p = 3;\n            setLoading(false);\n            return _context6.f(3);\n          case 4:\n            return _context6.a(2);\n        }\n      }, _callee6, null, [[0, 2, 3, 4]]);\n    }));\n    return function handleSaveEdit() {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n  var navigateToWebView = function navigateToWebView(path) {\n    if (!user) {\n      Taro.showToast({\n        title: '请先登录',\n        icon: 'none'\n      });\n      return;\n    }\n    Taro.navigateTo({\n      url: \"/pages/webview/index?url=\".concat(path)\n    });\n  };\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(PrivacyAgreementModal, {\n      visible: showPrivacyModal,\n      onAgree: handlePrivacyAgree,\n      onDisagree: handlePrivacyDisagree\n    }), /*#__PURE__*/_jsxs(View, {\n      className: \"profile-page\",\n      children: [/*#__PURE__*/_jsx(View, {\n        className: \"header\",\n        children: user ? /*#__PURE__*/_jsxs(View, {\n          className: \"user-info\",\n          children: [userInfo.avatarUrl ? /*#__PURE__*/_jsx(Image, {\n            className: \"avatar\",\n            src: userInfo.avatarUrl,\n            mode: \"aspectFill\"\n          }) : /*#__PURE__*/_jsx(View, {\n            className: \"avatar-placeholder\",\n            children: /*#__PURE__*/_jsx(Text, {\n              children: \"\\uD83D\\uDC64\"\n            })\n          }), /*#__PURE__*/_jsx(Text, {\n            className: \"nickname\",\n            children: userInfo.nickName || '用户'\n          }), /*#__PURE__*/_jsxs(Text, {\n            className: \"openid\",\n            children: [\"ID: \", userInfo.openId]\n          }), /*#__PURE__*/_jsx(Text, {\n            className: \"role\",\n            children: userInfo.userType === 'admin' ? '管理员' : '普通用户'\n          })]\n        }) : /*#__PURE__*/_jsxs(View, {\n          className: \"login-prompt\",\n          children: [/*#__PURE__*/_jsx(Text, {\n            className: \"prompt-text\",\n            children: \"\\u767B\\u5F55\\u540E\\u4F53\\u9A8C\\u66F4\\u591A\\u529F\\u80FD\"\n          }), /*#__PURE__*/_jsx(Button, {\n            className: \"login-btn\",\n            onClick: handleLogin,\n            children: \"\\u5FAE\\u4FE1\\u767B\\u5F55\"\n          })]\n        })\n      }), user && /*#__PURE__*/_jsxs(View, {\n        className: \"menu-list\",\n        children: [/*#__PURE__*/_jsxs(View, {\n          className: \"menu-section\",\n          children: [/*#__PURE__*/_jsxs(View, {\n            className: \"section-header\",\n            children: [/*#__PURE__*/_jsx(Text, {\n              className: \"section-title\",\n              children: \"\\u4E2A\\u4EBA\\u4FE1\\u606F\"\n            }), /*#__PURE__*/_jsx(Button, {\n              className: \"edit-btn\",\n              onClick: function onClick() {\n                if (isEditing) {\n                  setEditForm({\n                    nickName: userInfo.nickName || '',\n                    province: userInfo.province || '',\n                    city: userInfo.city || '',\n                    workYears: userInfo.workYears || 0\n                  });\n                }\n                setIsEditing(!isEditing);\n              },\n              children: isEditing ? '取消' : '编辑'\n            })]\n          }), isEditing ? /*#__PURE__*/_jsxs(View, {\n            className: \"edit-form\",\n            children: [/*#__PURE__*/_jsxs(View, {\n              className: \"form-group\",\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"form-label\",\n                children: \"\\u6635\\u79F0\"\n              }), /*#__PURE__*/_jsx(Input, {\n                className: \"form-input\",\n                value: editForm.nickName,\n                placeholder: \"\\u8BF7\\u8F93\\u5165\\u6635\\u79F0\",\n                onInput: function onInput(e) {\n                  return handleEditChange('nickName', e.detail.value);\n                }\n              })]\n            }), /*#__PURE__*/_jsxs(View, {\n              className: \"form-group\",\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"form-label\",\n                children: \"\\u6240\\u5728\\u7701\\u4EFD\"\n              }), /*#__PURE__*/_jsx(Input, {\n                className: \"form-input\",\n                value: editForm.province,\n                placeholder: \"\\u8BF7\\u8F93\\u5165\\u7701\\u4EFD\",\n                onInput: function onInput(e) {\n                  return handleEditChange('province', e.detail.value);\n                }\n              })]\n            }), /*#__PURE__*/_jsxs(View, {\n              className: \"form-group\",\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"form-label\",\n                children: \"\\u6240\\u5728\\u57CE\\u5E02\"\n              }), /*#__PURE__*/_jsx(Input, {\n                className: \"form-input\",\n                value: editForm.city,\n                placeholder: \"\\u8BF7\\u8F93\\u5165\\u57CE\\u5E02\",\n                onInput: function onInput(e) {\n                  return handleEditChange('city', e.detail.value);\n                }\n              })]\n            }), /*#__PURE__*/_jsxs(View, {\n              className: \"form-group\",\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"form-label\",\n                children: \"\\u5DE5\\u4F5C\\u5E74\\u9650\"\n              }), /*#__PURE__*/_jsx(Input, {\n                className: \"form-input\",\n                type: \"number\",\n                value: String(editForm.workYears),\n                placeholder: \"\\u8BF7\\u8F93\\u5165\\u5DE5\\u4F5C\\u5E74\\u9650\",\n                onInput: function onInput(e) {\n                  return handleEditChange('workYears', Number(e.detail.value));\n                }\n              })]\n            }), /*#__PURE__*/_jsx(Button, {\n              className: \"save-btn\",\n              onClick: handleSaveEdit,\n              loading: loading,\n              children: \"\\u4FDD\\u5B58\\u4FEE\\u6539\"\n            })]\n          }) : /*#__PURE__*/_jsxs(View, {\n            className: \"info-display\",\n            children: [/*#__PURE__*/_jsxs(View, {\n              className: \"info-item\",\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"info-label\",\n                children: \"\\u6240\\u5728\\u5730\"\n              }), /*#__PURE__*/_jsxs(Text, {\n                className: \"info-value\",\n                children: [userInfo.province, \" \", userInfo.city || '未设置']\n              })]\n            }), /*#__PURE__*/_jsxs(View, {\n              className: \"info-item\",\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"info-label\",\n                children: \"\\u5DE5\\u4F5C\\u5E74\\u9650\"\n              }), /*#__PURE__*/_jsxs(Text, {\n                className: \"info-value\",\n                children: [userInfo.workYears, \" \\u5E74\"]\n              })]\n            })]\n          })]\n        }), /*#__PURE__*/_jsxs(View, {\n          className: \"menu-section\",\n          children: [/*#__PURE__*/_jsxs(View, {\n            className: \"menu-item\",\n            onClick: function onClick() {\n              return navigateToWebView('https://help.manus.im');\n            },\n            children: [/*#__PURE__*/_jsx(Text, {\n              className: \"menu-text\",\n              children: \"\\u5E2E\\u52A9\\u4E0E\\u53CD\\u9988\"\n            }), /*#__PURE__*/_jsx(Text, {\n              className: \"menu-arrow\",\n              children: \">\"\n            })]\n          }), /*#__PURE__*/_jsxs(View, {\n            className: \"menu-item\",\n            onClick: function onClick() {\n              return navigateToWebView('https://manus.im/about');\n            },\n            children: [/*#__PURE__*/_jsx(Text, {\n              className: \"menu-text\",\n              children: \"\\u5173\\u4E8E\\u6211\\u4EEC\"\n            }), /*#__PURE__*/_jsx(Text, {\n              className: \"menu-arrow\",\n              children: \">\"\n            })]\n          })]\n        }), /*#__PURE__*/_jsx(Button, {\n          className: \"logout-btn\",\n          onClick: handleLogout,\n          children: \"\\u9000\\u51FA\\u767B\\u5F55\"\n        })]\n      })]\n    })]\n  });\n}","import Taro from '@tarojs/taro'\r\nimport { View, Text, ScrollView, Button } from '@tarojs/components'\r\nimport { useState } from 'react'\r\nimport './PrivacyAgreementModal.scss'\r\n\r\ninterface PrivacyAgreementModalProps {\r\n  visible: boolean\r\n  onAgree: () => void\r\n  onDisagree: () => void\r\n}\r\n\r\nexport default function PrivacyAgreementModal({\r\n  visible,\r\n  onAgree,\r\n  onDisagree\r\n}: PrivacyAgreementModalProps) {\r\n  const [scrolled, setScrolled] = useState(false)\r\n  const [agreed, setAgreed] = useState(false)\r\n\r\n  const handleScroll = (e: any) => {\r\n    const { scrollTop, scrollHeight, clientHeight } = e.detail\r\n    // 当滚动到底部时，允许同意\r\n    if (scrollTop + clientHeight >= scrollHeight - 10) {\r\n      setScrolled(true)\r\n    }\r\n  }\r\n\r\n  const handleAgree = () => {\r\n    if (!scrolled) {\r\n      Taro.showToast({\r\n        title: '请先阅读完整协议',\r\n        icon: 'none'\r\n      })\r\n      return\r\n    }\r\n    if (!agreed) {\r\n      Taro.showToast({\r\n        title: '请勾选同意协议',\r\n        icon: 'none'\r\n      })\r\n      return\r\n    }\r\n    onAgree()\r\n  }\r\n\r\n  if (!visible) {\r\n    return null\r\n  }\r\n\r\n  return (\r\n    <View className=\"privacy-modal-overlay\">\r\n      <View className=\"privacy-modal\">\r\n        {/* 标题 */}\r\n        <View className=\"privacy-modal-header\">\r\n          <Text className=\"privacy-modal-title\">用户隐私协议</Text>\r\n          <Text className=\"privacy-modal-subtitle\">请阅读并同意以下条款</Text>\r\n        </View>\r\n\r\n        {/* 协议内容 */}\r\n        <ScrollView\r\n          className=\"privacy-modal-content\"\r\n          scrollY\r\n          onScroll={handleScroll}\r\n        >\r\n          <View className=\"privacy-content-text\">\r\n            <View className=\"privacy-section\">\r\n              <Text className=\"privacy-section-title\">1. 隐私保护承诺</Text>\r\n              <Text className=\"privacy-section-content\">\r\n                转角驿站（以下简称\"本应用\"）尊重并保护所有用户的隐私。我们承诺按照本隐私协议的规定收集、使用和保护您的个人信息。\r\n              </Text>\r\n            </View>\r\n\r\n            <View className=\"privacy-section\">\r\n              <Text className=\"privacy-section-title\">2. 信息收集</Text>\r\n              <Text className=\"privacy-section-content\">\r\n                本应用收集以下信息：\r\n              </Text>\r\n              <View className=\"privacy-list\">\r\n                <Text className=\"privacy-list-item\">• 微信账户信息（昵称、头像、OpenID）</Text>\r\n                <Text className=\"privacy-list-item\">• 个人资料（省份、城市、工作年限）</Text>\r\n                <Text className=\"privacy-list-item\">• 使用行为数据（浏览记录、点赞、评论）</Text>\r\n                <Text className=\"privacy-list-item\">• 设备信息（设备型号、操作系统版本）</Text>\r\n              </View>\r\n            </View>\r\n\r\n            <View className=\"privacy-section\">\r\n              <Text className=\"privacy-section-title\">3. 信息使用</Text>\r\n              <Text className=\"privacy-section-content\">\r\n                我们收集的信息将用于以下目的：\r\n              </Text>\r\n              <View className=\"privacy-list\">\r\n                <Text className=\"privacy-list-item\">• 提供和改进应用服务</Text>\r\n                <Text className=\"privacy-list-item\">• 个性化内容推荐</Text>\r\n                <Text className=\"privacy-list-item\">• 用户身份验证和账户安全</Text>\r\n                <Text className=\"privacy-list-item\">• 数据分析和统计</Text>\r\n                <Text className=\"privacy-list-item\">• 法律合规和纠纷解决</Text>\r\n              </View>\r\n            </View>\r\n\r\n            <View className=\"privacy-section\">\r\n              <Text className=\"privacy-section-title\">4. 信息保护</Text>\r\n              <Text className=\"privacy-section-content\">\r\n                本应用采取以下措施保护您的个人信息：\r\n              </Text>\r\n              <View className=\"privacy-list\">\r\n                <Text className=\"privacy-list-item\">• 使用加密技术传输敏感数据</Text>\r\n                <Text className=\"privacy-list-item\">• 限制员工访问个人信息</Text>\r\n                <Text className=\"privacy-list-item\">• 定期安全审计和更新</Text>\r\n                <Text className=\"privacy-list-item\">• 遵守国家数据保护法规</Text>\r\n              </View>\r\n            </View>\r\n\r\n            <View className=\"privacy-section\">\r\n              <Text className=\"privacy-section-title\">5. 信息共享</Text>\r\n              <Text className=\"privacy-section-content\">\r\n                除以下情况外，本应用不会与第三方共享您的个人信息：\r\n              </Text>\r\n              <View className=\"privacy-list\">\r\n                <Text className=\"privacy-list-item\">• 获得您的明确同意</Text>\r\n                <Text className=\"privacy-list-item\">• 法律要求或政府部门要求</Text>\r\n                <Text className=\"privacy-list-item\">• 与服务提供商共享（受保密协议约束）</Text>\r\n              </View>\r\n            </View>\r\n\r\n            <View className=\"privacy-section\">\r\n              <Text className=\"privacy-section-title\">6. 用户权利</Text>\r\n              <Text className=\"privacy-section-content\">\r\n                您有权：\r\n              </Text>\r\n              <View className=\"privacy-list\">\r\n                <Text className=\"privacy-list-item\">• 访问和查看您的个人信息</Text>\r\n                <Text className=\"privacy-list-item\">• 更正不准确的个人信息</Text>\r\n                <Text className=\"privacy-list-item\">• 删除您的个人信息</Text>\r\n                <Text className=\"privacy-list-item\">• 撤回同意</Text>\r\n                <Text className=\"privacy-list-item\">• 获取个人信息副本</Text>\r\n              </View>\r\n            </View>\r\n\r\n            <View className=\"privacy-section\">\r\n              <Text className=\"privacy-section-title\">7. 数据保留</Text>\r\n              <Text className=\"privacy-section-content\">\r\n                我们仅在必要期间内保留您的个人信息。当信息不再需要时，我们将安全删除或匿名处理。\r\n              </Text>\r\n            </View>\r\n\r\n            <View className=\"privacy-section\">\r\n              <Text className=\"privacy-section-title\">8. 未成年人保护</Text>\r\n              <Text className=\"privacy-section-content\">\r\n                本应用不向未满 18 岁的未成年人收集个人信息。如发现收集了未成年人的信息，我们将立即删除。\r\n              </Text>\r\n            </View>\r\n\r\n            <View className=\"privacy-section\">\r\n              <Text className=\"privacy-section-title\">9. 协议更新</Text>\r\n              <Text className=\"privacy-section-content\">\r\n                本应用可能会不定期更新本隐私协议。更新后的协议将在应用内发布，您继续使用应用即表示同意更新后的协议。\r\n              </Text>\r\n            </View>\r\n\r\n            <View className=\"privacy-section\">\r\n              <Text className=\"privacy-section-title\">10. 联系我们</Text>\r\n              <Text className=\"privacy-section-content\">\r\n                如您对本隐私协议有任何疑问或建议，请通过以下方式联系我们：\r\n              </Text>\r\n              <View className=\"privacy-list\">\r\n                <Text className=\"privacy-list-item\">• 邮箱：support@manus.im</Text>\r\n                <Text className=\"privacy-list-item\">• 微信公众号：转角驿站</Text>\r\n              </View>\r\n            </View>\r\n\r\n            <View className=\"privacy-section\">\r\n              <Text className=\"privacy-section-title\">11. 服务条款</Text>\r\n              <Text className=\"privacy-section-content\">\r\n                使用本应用即表示您同意遵守以下服务条款：\r\n              </Text>\r\n              <View className=\"privacy-list\">\r\n                <Text className=\"privacy-list-item\">• 您承诺提供真实、准确的个人信息</Text>\r\n                <Text className=\"privacy-list-item\">• 您不得发布违法、骚扰、诽谤或商业宣传内容</Text>\r\n                <Text className=\"privacy-list-item\">• 您不得进行任何形式的网络攻击或滥用</Text>\r\n                <Text className=\"privacy-list-item\">• 本应用保留删除违规内容和禁用账户的权利</Text>\r\n                <Text className=\"privacy-list-item\">• 本应用对用户因违反本条款造成的损失不承担责任</Text>\r\n              </View>\r\n            </View>\r\n\r\n            <View className=\"privacy-section\">\r\n              <Text className=\"privacy-section-title\">12. 免责声明</Text>\r\n              <Text className=\"privacy-section-content\">\r\n                本应用按\"现状\"提供服务。我们不保证服务不会中断或不会出现错误。在任何情况下，本应用及其所有者、员工、代理人不对任何间接、附带、特殊或后果性损害负责。\r\n              </Text>\r\n            </View>\r\n\r\n            <View className=\"privacy-section privacy-section-last\">\r\n              <Text className=\"privacy-section-content\">\r\n                最后更新时间：2026 年 1 月 29 日\r\n              </Text>\r\n            </View>\r\n          </View>\r\n        </ScrollView>\r\n\r\n        {/* 底部操作 */}\r\n        <View className=\"privacy-modal-footer\">\r\n          {/* 同意复选框 */}\r\n          <View className=\"privacy-checkbox-group\">\r\n            <View\r\n              className={`privacy-checkbox ${agreed ? 'checked' : ''}`}\r\n              onClick={() => setAgreed(!agreed)}\r\n            >\r\n              {agreed && <Text className=\"privacy-checkbox-icon\">✓</Text>}\r\n            </View>\r\n            <Text className=\"privacy-checkbox-label\">\r\n              我已阅读并同意《用户隐私协议》和《服务条款》\r\n            </Text>\r\n          </View>\r\n\r\n          {/* 按钮组 */}\r\n          <View className=\"privacy-button-group\">\r\n            <Button\r\n              className=\"privacy-button privacy-button-cancel\"\r\n              onClick={onDisagree}\r\n            >\r\n              不同意\r\n            </Button>\r\n            <Button\r\n              className={`privacy-button privacy-button-agree ${\r\n                scrolled && agreed ? 'enabled' : 'disabled'\r\n              }`}\r\n              onClick={handleAgree}\r\n              disabled={!scrolled || !agreed}\r\n            >\r\n              同意并继续\r\n            </Button>\r\n          </View>\r\n        </View>\r\n      </View>\r\n    </View>\r\n  )\r\n}\r\n","/**\r\n * 隐私协议相关常量\r\n */\r\n\r\nexport const PRIVACY_AGREEMENT_KEY = 'privacy_agreement_agreed'\r\nexport const PRIVACY_AGREEMENT_VERSION = '1.0.0'\r\nexport const PRIVACY_AGREEMENT_TIMESTAMP_KEY = 'privacy_agreement_timestamp'\r\n\r\n/**\r\n * 检查用户是否已同意隐私协议\r\n */\r\nexport function hasAgreedPrivacyPolicy(): boolean {\r\n  try {\r\n    const agreed = localStorage.getItem(PRIVACY_AGREEMENT_KEY)\r\n    return agreed === 'true'\r\n  } catch {\r\n    return false\r\n  }\r\n}\r\n\r\n/**\r\n * 保存用户隐私协议同意状态\r\n */\r\nexport function savePrivacyPolicyAgreement(): void {\r\n  try {\r\n    localStorage.setItem(PRIVACY_AGREEMENT_KEY, 'true')\r\n    localStorage.setItem(\r\n      PRIVACY_AGREEMENT_TIMESTAMP_KEY,\r\n      new Date().toISOString()\r\n    )\r\n  } catch (error) {\r\n    console.error('Failed to save privacy policy agreement:', error)\r\n  }\r\n}\r\n\r\n/**\r\n * 清除隐私协议同意状态\r\n */\r\nexport function clearPrivacyPolicyAgreement(): void {\r\n  try {\r\n    localStorage.removeItem(PRIVACY_AGREEMENT_KEY)\r\n    localStorage.removeItem(PRIVACY_AGREEMENT_TIMESTAMP_KEY)\r\n  } catch (error) {\r\n    console.error('Failed to clear privacy policy agreement:', error)\r\n  }\r\n}\r\n\r\n/**\r\n * 获取隐私协议同意时间\r\n */\r\nexport function getPrivacyPolicyAgreementTime(): string | null {\r\n  try {\r\n    return localStorage.getItem(PRIVACY_AGREEMENT_TIMESTAMP_KEY)\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/profile/index!./index.tsx\"\nvar config = {\"navigationBarTitleText\":\"我的\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/profile/index', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n"],"names":[],"ignoreList":[],"sourceRoot":""}