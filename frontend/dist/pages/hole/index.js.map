{"version":3,"file":"pages/hole/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACnLA;AAoBA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;;;;;;;;;;;;AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://zhuanjiao-yizhan-miniprogram/./src/pages/hole/index.tsx?5aa9","webpack://zhuanjiao-yizhan-miniprogram/._src_api_hole.ts","webpack://zhuanjiao-yizhan-miniprogram/._src_pages_hole_index.tsx"],"sourcesContent":["import _regenerator from \"E:/Manus-Turning-Point-/frontend/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _asyncToGenerator from \"E:/Manus-Turning-Point-/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"E:/Manus-Turning-Point-/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { View, Text, ScrollView, Button } from '@tarojs/components';\nimport Taro from '@tarojs/taro';\nimport { useState, useEffect } from 'react';\nimport { getPostList } from '@/api/hole';\nimport { useUserStore } from '@/store/user';\nimport './index.scss';\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function Hole() {\n  var _useUserStore = useUserStore(),\n    user = _useUserStore.user;\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    posts = _useState2[0],\n    setPosts = _useState2[1];\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loading = _useState4[0],\n    setLoading = _useState4[1];\n  useEffect(function () {\n    loadPosts();\n  }, []);\n  var loadPosts = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n      var data, _t;\n      return _regenerator().w(function (_context) {\n        while (1) switch (_context.p = _context.n) {\n          case 0:\n            _context.p = 0;\n            setLoading(true);\n            _context.n = 1;\n            return getPostList();\n          case 1:\n            data = _context.v;\n            setPosts(data);\n            _context.n = 3;\n            break;\n          case 2:\n            _context.p = 2;\n            _t = _context.v;\n            Taro.showToast({\n              title: _t.message || '加载失败',\n              icon: 'none'\n            });\n          case 3:\n            _context.p = 3;\n            setLoading(false);\n            return _context.f(3);\n          case 4:\n            return _context.a(2);\n        }\n      }, _callee, null, [[0, 2, 3, 4]]);\n    }));\n    return function loadPosts() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var navigateToDetail = function navigateToDetail(id) {\n    Taro.navigateTo({\n      url: \"/pages/webview/index?url=/hole/\".concat(id)\n    });\n  };\n  var handleCreatePost = function handleCreatePost() {\n    if (!user) {\n      Taro.showToast({\n        title: '请先登录',\n        icon: 'none'\n      });\n      return;\n    }\n    Taro.navigateTo({\n      url: \"/pages/webview/index?url=/hole/create\"\n    });\n  };\n  var formatTime = function formatTime(timestamp) {\n    var now = Date.now();\n    var diff = now - timestamp;\n    var minute = 60 * 1000;\n    var hour = 60 * minute;\n    var day = 24 * hour;\n    if (diff < minute) {\n      return '刚刚';\n    } else if (diff < hour) {\n      return \"\".concat(Math.floor(diff / minute), \"\\u5206\\u949F\\u524D\");\n    } else if (diff < day) {\n      return \"\".concat(Math.floor(diff / hour), \"\\u5C0F\\u65F6\\u524D\");\n    } else {\n      return \"\".concat(Math.floor(diff / day), \"\\u5929\\u524D\");\n    }\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsx(View, {\n      className: \"hole-page\",\n      children: /*#__PURE__*/_jsx(View, {\n        className: \"loading\",\n        children: \"\\u52A0\\u8F7D\\u4E2D...\"\n      })\n    });\n  }\n  return /*#__PURE__*/_jsxs(View, {\n    className: \"hole-page\",\n    children: [/*#__PURE__*/_jsxs(View, {\n      className: \"header\",\n      children: [/*#__PURE__*/_jsxs(View, {\n        className: \"header-content\",\n        children: [/*#__PURE__*/_jsx(Text, {\n          className: \"title\",\n          children: \"\\u6811\\u6D1E\"\n        }), /*#__PURE__*/_jsx(Text, {\n          className: \"subtitle\",\n          children: \"\\u503E\\u8BC9\\u4F60\\u7684\\u5FC3\\u58F0\\uFF0C\\u6211\\u4EEC\\u5728\\u8FD9\\u91CC\\u503E\\u542C\"\n        })]\n      }), /*#__PURE__*/_jsx(Button, {\n        className: \"create-btn\",\n        onClick: handleCreatePost,\n        children: \"\\u53D1\\u5E03\"\n      })]\n    }), /*#__PURE__*/_jsxs(ScrollView, {\n      className: \"post-list\",\n      scrollY: true,\n      children: [posts.map(function (post) {\n        return /*#__PURE__*/_jsxs(View, {\n          className: \"post-card\",\n          onClick: function onClick() {\n            return navigateToDetail(post.id);\n          },\n          children: [/*#__PURE__*/_jsxs(View, {\n            className: \"post-header\",\n            children: [/*#__PURE__*/_jsx(Text, {\n              className: \"author\",\n              children: post.author || '匿名用户'\n            }), /*#__PURE__*/_jsx(Text, {\n              className: \"time\",\n              children: formatTime(post.createdAt)\n            })]\n          }), /*#__PURE__*/_jsx(Text, {\n            className: \"post-content\",\n            children: post.content\n          }), post.tags && post.tags.length > 0 && /*#__PURE__*/_jsx(View, {\n            className: \"tags\",\n            children: post.tags.map(function (tag, index) {\n              return /*#__PURE__*/_jsxs(Text, {\n                className: \"tag\",\n                children: [\"#\", tag]\n              }, index);\n            })\n          }), /*#__PURE__*/_jsxs(View, {\n            className: \"post-footer\",\n            children: [/*#__PURE__*/_jsxs(View, {\n              className: \"stat-item\",\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"stat-icon\",\n                children: \"\\uD83D\\uDC4D\"\n              }), /*#__PURE__*/_jsx(Text, {\n                className: \"stat-count\",\n                children: post.likes || 0\n              })]\n            }), /*#__PURE__*/_jsxs(View, {\n              className: \"stat-item\",\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"stat-icon\",\n                children: \"\\uD83D\\uDCAC\"\n              }), /*#__PURE__*/_jsx(Text, {\n                className: \"stat-count\",\n                children: post.comments || 0\n              })]\n            })]\n          })]\n        }, post.id);\n      }), posts.length === 0 && /*#__PURE__*/_jsx(View, {\n        className: \"empty\",\n        children: /*#__PURE__*/_jsx(Text, {\n          children: \"\\u8FD8\\u6CA1\\u6709\\u5E16\\u5B50\\uFF0C\\u5FEB\\u6765\\u53D1\\u5E03\\u7B2C\\u4E00\\u6761\\u5427\\uFF01\"\n        })\n      })]\n    })]\n  });\n}","import { get, post } from './request';\r\n\r\nexport interface Post {\r\n  id: number;\r\n  title: string;\r\n  content: string;\r\n  authorId: number;\r\n  authorName: string;\r\n  authorAvatar: string;\r\n  likeCount: number;\r\n  commentCount: number;\r\n  createdAt: string;\r\n  isLiked: boolean;\r\n}\r\n\r\nexport interface PostListParams {\r\n  page?: number;\r\n  pageSize?: number;\r\n}\r\n\r\n/**\r\n * 获取帖子列表\r\n */\r\nexport function getPostList(params: PostListParams = {}) {\r\n  return get<{ posts: Post[]; total: number }>('/api/trpc/hole.list', {\r\n    page: params.page || 1,\r\n    pageSize: params.pageSize || 20\r\n  });\r\n}\r\n\r\n/**\r\n * 点赞帖子\r\n */\r\nexport function likePost(postId: number) {\r\n  return post('/api/trpc/hole.like', { postId });\r\n}\r\n\r\n/**\r\n * 取消点赞\r\n */\r\nexport function unlikePost(postId: number) {\r\n  return post('/api/trpc/hole.unlike', { postId });\r\n}\r\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/hole/index!./index.tsx\"\nvar config = {\"navigationBarTitleText\":\"树洞\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/hole/index', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n"],"names":[],"ignoreList":[],"sourceRoot":""}