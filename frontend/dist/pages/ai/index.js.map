{"version":3,"file":"pages/ai/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC/HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;ACRA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAVA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;ACHA;AAEA;;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AARA;AAAA;AAUA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAhCA;AAAA;AAAA","sources":["webpack://zhuanjiao-yizhan-miniprogram/./src/pages/ai/index.tsx?f2d7","webpack://zhuanjiao-yizhan-miniprogram/._src_pages_ai_index.tsx","webpack://zhuanjiao-yizhan-miniprogram/._src_services_chat.ts","webpack://zhuanjiao-yizhan-miniprogram/._src_utils_request.ts"],"sourcesContent":["import _regenerator from \"E:/Manus-Turning-Point-/frontend/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _toConsumableArray from \"E:/Manus-Turning-Point-/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _asyncToGenerator from \"E:/Manus-Turning-Point-/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"E:/Manus-Turning-Point-/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { useState } from 'react';\nimport { View, Input, Button, ScrollView } from '@tarojs/components';\nimport Taro from '@tarojs/taro';\nimport { sendMessage } from '../../services/chat';\nimport './index.scss';\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function AI() {\n  var _useState = useState([{\n      role: 'bot',\n      content: '你好！我是转角驿站的 AI 助手，有什么可以帮你的吗？'\n    }]),\n    _useState2 = _slicedToArray(_useState, 2),\n    messages = _useState2[0],\n    setMessages = _useState2[1];\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    inputValue = _useState4[0],\n    setInputValue = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    loading = _useState6[0],\n    setLoading = _useState6[1];\n  var handleSend = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n      var userMsg, res, _t;\n      return _regenerator().w(function (_context) {\n        while (1) switch (_context.p = _context.n) {\n          case 0:\n            if (!(!inputValue.trim() || loading)) {\n              _context.n = 1;\n              break;\n            }\n            return _context.a(2);\n          case 1:\n            userMsg = {\n              role: 'user',\n              content: inputValue\n            };\n            setMessages(function (prev) {\n              return [].concat(_toConsumableArray(prev), [userMsg]);\n            });\n            setInputValue('');\n            setLoading(true);\n            _context.p = 2;\n            _context.n = 3;\n            return sendMessage(inputValue);\n          case 3:\n            res = _context.v;\n            if (res.success) {\n              setMessages(function (prev) {\n                return [].concat(_toConsumableArray(prev), [{\n                  role: 'bot',\n                  content: res.reply\n                }]);\n              });\n            } else {\n              Taro.showToast({\n                title: res.message || '发送失败',\n                icon: 'none'\n              });\n            }\n            _context.n = 5;\n            break;\n          case 4:\n            _context.p = 4;\n            _t = _context.v;\n            Taro.showToast({\n              title: '网络错误',\n              icon: 'none'\n            });\n          case 5:\n            _context.p = 5;\n            setLoading(false);\n            return _context.f(5);\n          case 6:\n            return _context.a(2);\n        }\n      }, _callee, null, [[2, 4, 5, 6]]);\n    }));\n    return function handleSend() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  return /*#__PURE__*/_jsxs(View, {\n    className: \"ai-page\",\n    children: [/*#__PURE__*/_jsxs(ScrollView, {\n      className: \"chat-window\",\n      scrollY: true,\n      scrollWithAnimation: true,\n      children: [messages.map(function (msg, index) {\n        return /*#__PURE__*/_jsx(View, {\n          className: \"message-item \".concat(msg.role),\n          children: /*#__PURE__*/_jsx(View, {\n            className: \"content\",\n            children: msg.content\n          })\n        }, index);\n      }), loading && /*#__PURE__*/_jsx(View, {\n        className: \"message-item bot\",\n        children: /*#__PURE__*/_jsx(View, {\n          className: \"content\",\n          children: \"\\u6B63\\u5728\\u601D\\u8003...\"\n        })\n      })]\n    }), /*#__PURE__*/_jsxs(View, {\n      className: \"input-area\",\n      children: [/*#__PURE__*/_jsx(Input, {\n        className: \"input\",\n        value: inputValue,\n        onInput: function onInput(e) {\n          return setInputValue(e.detail.value);\n        },\n        placeholder: \"\\u8F93\\u5165\\u6D88\\u606F...\",\n        confirmType: \"send\",\n        onConfirm: handleSend\n      }), /*#__PURE__*/_jsx(Button, {\n        className: \"send-btn\",\n        onClick: handleSend,\n        disabled: loading,\n        children: \"\\u53D1\\u9001\"\n      })]\n    })]\n  });\n}","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/ai/index!./index.tsx\"\nvar config = {};\n\n\nvar inst = Page(createPageConfig(component, 'pages/ai/index', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n","import { request } from '../utils/request';\r\nimport Taro from '@tarojs/taro';\r\n\r\nexport const sendMessage = async (message: string) => {\r\n  const userId = Taro.getStorageSync('userId');\r\n  return request({\r\n    url: '/chat/send',\r\n    method: 'POST',\r\n    data: {\r\n      userId,\r\n      message,\r\n    },\r\n  });\r\n};\r\n","import Taro from '@tarojs/taro';\r\n\r\nconst BASE_URL = 'http://192.168.31.20:8080/api'; // 本地调试地址\r\n\r\nexport const request = async (options: any) => {\r\n  const { url, method = 'GET', data, header = {} } = options;\r\n  \r\n  // 从本地缓存获取 token\r\n  const token = Taro.getStorageSync('token');\r\n  if (token) {\r\n    header['Authorization'] = `Bearer ${token}`;\r\n  }\r\n\r\n  try {\r\n    const res = await Taro.request({\r\n      url: `${BASE_URL}${url}`,\r\n      method,\r\n      data,\r\n      header: {\r\n        'Content-Type': 'application/json',\r\n        ...header,\r\n      },\r\n    });\r\n\r\n    if (res.statusCode >= 200 && res.statusCode < 300) {\r\n      return res.data;\r\n    } else {\r\n      throw new Error(res.data.message || '请求失败');\r\n    }\r\n  } catch (error) {\r\n    Taro.showToast({\r\n      title: error.message || '网络请求失败',\r\n      icon: 'none',\r\n    });\r\n    throw error;\r\n  }\r\n};\r\n"],"names":[],"ignoreList":[],"sourceRoot":""}